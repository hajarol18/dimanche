<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ======================================== -->
    <!-- TABLEAU DE BORD PRINCIPAL SMARTAGRI -->
    <!-- ======================================== -->
    
    <!-- Vue tableau de bord principal -->
    <record id="view_smart_agri_tableau_bord_form" model="ir.ui.view">
        <field name="name">smart.agri.tableau.bord.form</field>
        <field name="model">smart_agri_tableau_bord</field>
        <field name="arch" type="xml">
            <form string="Tableau de Bord SmartAgri">
                <header>
                    <button name="action_actualiser_donnees" 
                            string="ðŸ”„ Actualiser" 
                            type="object" 
                            class="oe_highlight"/>
                </header>
                <sheet>
                    <!-- INFORMATIONS GÃ‰NÃ‰RALES -->
                    <group string="Informations GÃ©nÃ©rales">
                        <group>
                            <field name="exploitation_id"/>
                        </group>
                    </group>
                    
                    <!-- MÃ‰TRIQUES CLÃ‰S -->
                    <group string="MÃ©triques ClÃ©s" class="oe_subtotal_footer">
                        <group>
                            <field name="rendement_moyen"/>
                            <field name="rendement_optimal"/>
                            <field name="taux_realisation"/>
                        </group>
                        <group>
                            <field name="efficacite_irrigation" widget="percentage"/>
                            <field name="indice_qualite_sol" widget="percentage"/>
                            <field name="score_ia_global" widget="percentage"/>
                        </group>
                    </group>
                    
                    <!-- ALERTES ET RECOMMANDATIONS -->
                    <notebook>
                        <page string="ðŸš¨ Alertes Actives" name="alertes">
                            <field name="alertes_actives" nolabel="1" readonly="1"/>
                        </page>
                        <page string="ðŸ’¡ Recommandations IA" name="recommandations">
                            <field name="recommandations_ia" nolabel="1" readonly="1"/>
                        </page>
                        <page string="ðŸŽ¯ Actions Prioritaires" name="actions">
                            <field name="actions_prioritaires" nolabel="1" readonly="1"/>
                        </page>
                        <page string="ðŸ“Š Indicateurs Climatiques" name="climat">
                            <group>
                                <field name="temperature_moyenne"/>
                                <field name="precipitation_totale"/>
                                <field name="risque_secheresse"/>
                                <field name="indice_climatique"/>
                            </group>
                        </page>
                        <page string="ðŸŒ± QualitÃ© du Sol" name="sol">
                            <group>
                                <field name="ph_sol_moyen"/>
                                <field name="azote_sol_moyen"/>
                                <field name="phosphore_sol_moyen"/>
                                <field name="potassium_sol_moyen"/>
                                <field name="indice_qualite_sol"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Vue kanban tableau de bord -->
    <record id="view_smart_agri_tableau_bord_kanban" model="ir.ui.view">
        <field name="name">smart.agri.tableau.bord.kanban</field>
        <field name="model">smart_agri_tableau_bord</field>
        <field name="arch" type="xml">
            <kanban string="Tableaux de Bord" class="o_kanban_dashboard">
                <field name="exploitation_id"/>
                <field name="rendement_moyen"/>
                <field name="rendement_optimal"/>
                <field name="taux_realisation"/>
                <field name="efficacite_irrigation"/>
                <field name="indice_qualite_sol"/>
                <field name="score_ia_global"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click oe_kanban_color_5">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="exploitation_id"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle">
                                            Tableau de Bord
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-6">
                                            <strong>ðŸŒ¾ Rendement:</strong><br/>
                                            <field name="rendement_moyen"/> t/ha
                                        </div>
                                        <div class="col-6">
                                            <strong>ðŸŽ¯ Optimal:</strong><br/>
                                            <field name="rendement_optimal"/> t/ha
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <strong>ðŸ’§ Irrigation:</strong><br/>
                                            <span t-attf-class="#{record.efficacite_irrigation.value &lt; 60 ? 'text-danger' : record.efficacite_irrigation.value &lt; 80 ? 'text-warning' : 'text-success'}">
                                                <field name="efficacite_irrigation"/>%
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <strong>ðŸŒ± QualitÃ© Sol:</strong><br/>
                                            <span t-attf-class="#{record.indice_qualite_sol.value &lt; 50 ? 'text-danger' : record.indice_qualite_sol.value &lt; 70 ? 'text-warning' : 'text-success'}">
                                                <field name="indice_qualite_sol"/>%
                                            </span>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-6">
                                            <strong>ðŸ¤– Score IA:</strong><br/>
                                            <span t-attf-class="#{record.score_ia_global.value &lt; 60 ? 'text-danger' : record.score_ia_global.value &lt; 80 ? 'text-warning' : 'text-success'}">
                                                <field name="score_ia_global"/>%
                                            </span>
                                        </div>
                                        <div class="col-6">
                                            <strong>ðŸ“Š RÃ©alisation:</strong><br/>
                                            <field name="taux_realisation"/>%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Vue liste tableau de bord -->
    <record id="view_smart_agri_tableau_bord_list" model="ir.ui.view">
        <field name="name">smart.agri.tableau.bord.list</field>
        <field name="model">smart_agri_tableau_bord</field>
        <field name="arch" type="xml">
            <list string="Tableaux de Bord">
                <field name="exploitation_id"/>
                <field name="rendement_moyen"/>
                <field name="rendement_optimal"/>
                <field name="taux_realisation"/>
                <field name="efficacite_irrigation" widget="percentage"/>
                <field name="indice_qualite_sol" widget="percentage"/>
                <field name="score_ia_global" widget="percentage"/>
            </list>
        </field>
    </record>
    
    <!-- Vue recherche tableau de bord -->
    <record id="view_smart_agri_tableau_bord_search" model="ir.ui.view">
        <field name="name">smart.agri.tableau.bord.search</field>
        <field name="model">smart_agri_tableau_bord</field>
        <field name="arch" type="xml">
            <search string="Recherche Tableaux de Bord">
                <field name="exploitation_id"/>
                <field name="risque_secheresse"/>
                <field name="risque_climatique"/>
                
                <filter string="Risque Faible" name="risque_faible" domain="[('risque_secheresse', '=', 'faible')]"/>
                <filter string="Risque ModÃ©rÃ©" name="risque_modere" domain="[('risque_secheresse', '=', 'modere')]"/>
                <filter string="Risque Ã‰levÃ©" name="risque_eleve" domain="[('risque_secheresse', '=', 'eleve')]"/>
                
                <filter string="Rendement > 5 t/ha" name="rendement_eleve" domain="[('rendement_moyen', '>', 5)]"/>
                <filter string="EfficacitÃ© > 80%" name="efficacite_elevee" domain="[('efficacite_irrigation', '>', 80)]"/>
                
                <group expand="0" string="Regrouper par">
                    <filter string="Exploitation" name="group_exploitation" context="{'group_by': 'exploitation_id'}"/>
                    <filter string="Risque SÃ©cheresse" name="group_risque_secheresse" context="{'group_by': 'risque_secheresse'}"/>
                    <filter string="Risque Climatique" name="group_risque_climatique" context="{'group_by': 'risque_climatique'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Action tableau de bord -->
    <record id="action_smart_agri_tableau_bord" model="ir.actions.act_window">
        <field name="name">Tableaux de Bord</field>
        <field name="res_model">smart_agri_tableau_bord</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_id" ref="view_smart_agri_tableau_bord_kanban"/>
        <field name="context">{'search_default_risque_faible': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocent_smiling_face">
                Aucun tableau de bord disponible
            </p>
            <p>
                CrÃ©ez votre premier tableau de bord pour visualiser les performances de votre exploitation.
            </p>
            <p>
                <strong>FonctionnalitÃ©s :</strong><br/>
                â€¢ Vue d'ensemble des mÃ©triques clÃ©s<br/>
                â€¢ Alertes et recommandations en temps rÃ©el<br/>
                â€¢ Analyse des tendances climatiques<br/>
                â€¢ Planification des actions prioritaires
            </p>
        </field>
    </record>
    
</odoo>
