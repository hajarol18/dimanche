<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- ======================================== -->
        <!-- VUES ALERTES CLIMATIQUES COMPL√àTES -->
        <!-- ======================================== -->
        
        <!-- Vue liste des alertes climatiques avec indicateurs -->
        <record id="view_alerte_climatique_list" model="ir.ui.view">
            <field name="name">smart.agri.alerte.climatique.list</field>
            <field name="model">smart_agri_alerte_climatique</field>
            <field name="arch" type="xml">
                <list string="üö® Alertes Climatiques Agricoles" 
                      decoration-info="state == 'surveillee'"
                      decoration-warning="state == 'active'"
                      decoration-success="state == 'resolue'"
                      decoration-danger="state == 'active' and niveau in ['rouge', 'noir']">
                    <field name="name"/>
                    <field name="exploitation_id"/>
                    <field name="type_alerte"/>
                    <field name="niveau" widget="badge"
                           decoration-success="niveau == 'vert'"
                           decoration-warning="niveau == 'jaune'"
                           decoration-danger="niveau in ['orange', 'rouge', 'noir']"/>
                    <field name="priorite" widget="badge"
                           decoration-success="priorite == 'basse'"
                           decoration-warning="priorite == 'normale'"
                           decoration-danger="priorite in ['haute', 'urgente', 'critique']"/>
                    <field name="date_detection"/>
                    <field name="state"/>
                    <field name="source"/>
                    <field name="niveau_impact"/>
                </list>
            </field>
        </record>

        <!-- Vue formulaire compl√®te des alertes climatiques -->
        <record id="view_alerte_climatique_form" model="ir.ui.view">
            <field name="name">smart.agri.alerte.climatique.form</field>
            <field name="model">smart_agri_alerte_climatique</field>
            <field name="arch" type="xml">
                <form string="üö® Alerte Climatique Agricole">
                    <header>
                        <button name="notifier_alerte" type="object" string="üì¢ Notifier" 
                                class="btn-primary"
                                invisible="notifiee"/>
                        <button name="resoudre_alerte" type="object" string="‚úÖ R√©soudre" 
                                class="btn-success"
                                invisible="state != 'active'"/>
                        <button name="archiver_alerte" type="object" string="üìÅ Archiver" 
                                class="btn-secondary"
                                invisible="state == 'archiv√©e'"/>
                        <field name="state" widget="statusbar" 
                               statusbar_visible="active,surveillee,resolue"/>
                    </header>
                    
                    <sheet>
                        <!-- Informations de base -->
                        <group>
                            <group string="üèûÔ∏è Exploitation">
                                <field name="exploitation_id" required="1"/>
                                <field name="name"/>
                                <field name="description"/>
                            </group>
                            <group string="üö® D√©tails Alerte">
                                <field name="type_alerte" required="1"/>
                                <field name="niveau" required="1"/>
                                <field name="priorite" readonly="1"/>
                                <field name="source" required="1"/>
                            </group>
                        </group>
                        
                        <!-- Dates et impact -->
                        <group string="üìÖ Chronologie et Impact">
                            <group string="Dates">
                                <field name="date_detection" required="1"/>
                                <field name="date_debut"/>
                                <field name="date_fin"/>
                            </group>
                            <group string="Impact Agricole">
                                <field name="niveau_impact"/>
                                <field name="impact_cultures" widget="many2many_tags"/>
                                <field name="impact_parcelles" widget="many2many_tags"/>
                            </group>
                        </group>
                        
                        <!-- Param√®tres m√©t√©orologiques -->
                        <group string="üå§Ô∏è Param√®tres M√©t√©o D√©clencheurs">
                            <group string="Temp√©ratures">
                                <field name="temperature_min"/>
                                <field name="temperature_max"/>
                            </group>
                            <group string="Autres param√®tres">
                                <field name="precipitation"/>
                                <field name="humidite"/>
                                <field name="vent_vitesse"/>
                            </group>
                        </group>
                        
                        <!-- NOUVEAUX CHAMPS : Analyse Intelligente -->
                        <group string="üß† Analyse Intelligente">
                            <group string="Qualit√©">
                                <field name="source"/>
                                <field name="date_detection"/>
                            </group>
                        </group>
                        
                        <!-- Actions et recommandations -->
                        <group string="üí° Actions et Recommandations">
                            <group string="Actions recommand√©es">
                                <field name="actions_recommandees" nolabel="1"/>
                            </group>
                            <group string="Actions urgentes">
                                <field name="actions_urgentes" nolabel="1"/>
                            </group>
                        </group>
                        
                        <!-- Suivi et notifications -->
                        <group string="üìä Suivi et Notifications">
                            <group string="Statut">
                                <field name="notifiee"/>
                                <field name="date_notification" readonly="1"/>
                            </group>
                            <group string="Notes">
                                <field name="notes" nolabel="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        
        <!-- Vue recherche des alertes climatiques -->
        <record id="view_alerte_climatique_search" model="ir.ui.view">
            <field name="name">smart.agri.alerte.climatique.search</field>
            <field name="model">smart_agri_alerte_climatique</field>
            <field name="arch" type="xml">
                <search string="Recherche Alertes Climatiques">
                    <field name="name"/>
                    <field name="exploitation_id"/>
                    <field name="type_alerte"/>
                    <field name="niveau"/>
                    <field name="source"/>
                    
                    <filter string="Alertes Actives" name="actives" domain="[('state', '=', 'active')]"/>
                    <filter string="Alertes Rouges" name="rouges" domain="[('niveau', '=', 'rouge')]"/>
                    <group expand="0" string="Regrouper par">
                        <filter string="Type d'alerte" name="group_type" context="{'group_by': 'type_alerte'}"/>
                        <filter string="Niveau" name="group_niveau" context="{'group_by': 'niveau'}"/>
                        <filter string="Exploitation" name="group_exploitation" context="{'group_by': 'exploitation_id'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- Vue graphique des alertes par type -->
        <record id="view_alerte_climatique_graph" model="ir.ui.view">
            <field name="name">smart.agri.alerte.climatique.graph</field>
            <field name="model">smart_agri_alerte_climatique</field>
            <field name="arch" type="xml">
                <graph string="Alertes Climatiques par Type" type="bar">
                    <field name="type_alerte"/>
                    <field name="id" type="measure"/>
                </graph>
            </field>
        </record>
        
        <!-- Vue pivot des alertes climatiques -->
        <record id="view_alerte_climatique_pivot" model="ir.ui.view">
            <field name="name">smart.agri.alerte.climatique.pivot</field>
            <field name="model">smart_agri_alerte_climatique</field>
            <field name="arch" type="xml">
                <pivot string="Analyse des Alertes Climatiques">
                    <field name="type_alerte" type="row"/>
                    <field name="niveau" type="row"/>
                    <field name="exploitation_id" type="row"/>
                    <field name="id" type="measure"/>
                </pivot>
            </field>
        </record>
        
        <!-- Action pour les alertes climatiques -->
        <record id="action_alerte_climatique" model="ir.actions.act_window">
            <field name="name">üö® Alertes Climatiques</field>
            <field name="res_model">smart_agri_alerte_climatique</field>
            <field name="view_mode">list,form,graph,pivot</field>
            <field name="context">{'search_default_actives': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aucune alerte climatique active !
                </p>
                <p>
                    Les alertes climatiques INTELLIGENTES vous informent des risques m√©t√©orologiques :
                    <br/>‚Ä¢ üåµ S√©cheresse et stress hydrique
                    <br/>‚Ä¢ ‚ùÑÔ∏è Gel et dommages aux cultures
                    <br/>‚Ä¢ üî• Canicule et stress thermique
                    <br/>‚Ä¢ üåä Inondations et exc√®s d'eau
                    <br/>‚Ä¢ üí® Vents forts et dommages m√©caniques
                    <br/>‚Ä¢ üíß Humidit√© faible
                    <br/><br/>
                    <strong>üß† NOUVEAU :</strong> Alertes bas√©es sur les VRAIES donn√©es m√©t√©o import√©es !
                </p>
            </field>
        </record>
        
        <!-- LES MENUS SONT MAINTENANT D√âFINIS DANS menu_meteo_climat.xml -->
        
    </data>
</odoo>